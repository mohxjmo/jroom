{# @Time    : 2018/5/14 20:08 #}
{% extends 'base.html' %}

{% block title %}
    发布房源
{% endblock %}

{% block more %}
    <li><a href="{{ url_for('index') }}" target="_blank"><i class="fas fa-map-marker-alt"></i>&nbsp;&nbsp;返回地图找房</a></li>
{% endblock %}

{% block head %}
    <!-- bootstrap -->
    <link rel='stylesheet' href="{{ url_for('static', filename="css/bootstrap.min.css") }}"/>
    <link rel="stylesheet" href="{{ url_for('static', filename="css/register.css") }}"/>
{% endblock %}

{% block main %}
    <div class="single">
        <img src="{{ url_for('static', filename="imgs/logo_pic_big.png") }}">
        <form class="form-horizontal" action="" method="post" id="posthouse">
            <p style="color: red"><i class="fas fa-exclamation-circle"></i>&nbsp;&nbsp;如您成功提交委托，24h内会有工作人员与您主动取得联系！</p><br>
            <div class="form-group" id="districtdiv">
                <label>行政区：</label>
                <input type="text" class="form-control" id="district" name="district" placeholder="请输入房屋所在行政区">
                <span id="districtblock" class="help-block"></span>
            </div>
            <div class="form-group" id="streetdiv">
                <label>街道：</label>
                <input type="text" class="form-control" id="street" name="street" placeholder="请输入房屋所在街道">
                <span id="streetblock" class="help-block"></span>
            </div>
            <div class="form-group" id="communitydiv">
                <label>详细地址（小区、楼号等）：</label>
                <input type="text" class="form-control" id="community" name="community" placeholder="请输入房屋详细地址">
                <span id="communityblock" class="help-block"></span>
            </div>
            <div class="form-group" id="pricediv">
                <label>期望租金(月付)：</label>
                <input type="text" class="form-control" id="price" name="price" placeholder="请输入期望租金">
                <span id="priceblock" class="help-block"></span>
            </div>
            <div class="form-group" id="teldiv">
                <label>联系方式：</label>
                <input type="text" class="form-control" id="tel" name="tel" placeholder="请输入您的联系方式">
                <span id="telblock" class="help-block"></span>
            </div>
            <input type="button" id='ok' class="btn btn-primary" value="提交委托">
        </form>
    </div>
{% endblock %}

{% block script %}
    <script>
        $('#district').blur(function district () {
            var district = $('#district').val();
            if(district==""){
                $('#districtdiv').attr("class", "form-group has-error");
                $('#districtblock').text("行政区不可为空");
            }
            else if(district.length > 10){
                $('#districtdiv').attr("class", "form-group has-error");
                $('#districtblock').text("行政区长度必须小于10个字符");
            }
            else{
                $('#districtdiv').attr("class", "form-group has-success");
                $('#districtblock').text("");
            }
        });
        $('#street').blur(function street() {
            var street = $('#street').val();
            if(street==""){
                $('#streetdiv').attr("class", "form-group has-error");
                $('#streetblock').text("街道不可为空");
            }
            else if(street.length > 50){
                $('#streetdiv').attr("class", "form-group has-error");
                $('#streetblock').text("街道长度必须小于10个字符");
            }
            else{
                $('#streetdiv').attr("class", "form-group has-success");
                $('#streetblock').text("");
            }
        });
        $('#community').blur(function community() {
            var community = $('#community').val();
            if(community==""){
                $('#communitydiv').attr("class", "form-group has-error");
                $('#communityblock').text("详细地址不可为空");
            }
            else if(community.length > 50){
                $('#communitydiv').attr("class", "form-group has-error");
                $('#communityblock').text("详细地址长度必须小于10个字符");
            }
            else{
                $('#communitydiv').attr("class", "form-group has-success");
                $('#communityblock').text("");
            }
        });
        $('#price').blur(function price() {
            var price = $('#price').val();
            if(price==""){
                $('#pricediv').attr("class", "form-group has-error");
                $('#priceblock').text("期望租金不可为空");
            }
            else if(!/^\d+$/.test(price)){
                $('#pricediv').attr("class", "form-group has-error");
                $('#priceblock').text("请输入数字");
            }
            else{
                $('#pricediv').attr("class", "form-group has-success");
                $('#priceblock').text("");
            }
        });
        $('#tel').blur(function tel() {
            var tel = $('#tel').val();
            if(tel==""){
                $('#teldiv').attr("class", "form-group has-error");
                $('#telblock').text("手机号码不可为空");
            }
            else if(tel.length != 11 || !/^1\d+$/.test(tel)){
                $('#teldiv').attr("class", "form-group has-error");
                $('#telblock').text("输入合法手机号码不合法");
            }
            else{
                $('#teldiv').attr("class", "form-group has-success");
                $('#telblock').text("");
            }
        });
        $('#ok').click(function () {
            var a = false,b = false,c = false,d = false,e = false;
            var district = $('#district').val();
            if(district==""){
                $('#districtdiv').attr("class", "form-group has-error");
                $('#districtblock').text("行政区不可为空");
            }
            else if(district.length > 10){
                $('#districtdiv').attr("class", "form-group has-error");
                $('#districtblock').text("行政区长度必须小于10个字符");
            }
            else{
                $('#districtdiv').attr("class", "form-group has-success");
                $('#districtblock').text("");
                a = true;
            }
            var street = $('#street').val();
            if(street==""){
                $('#streetdiv').attr("class", "form-group has-error");
                $('#streetblock').text("街道不可为空");
            }
            else if(street.length > 50){
                $('#streetdiv').attr("class", "form-group has-error");
                $('#streetblock').text("街道长度必须小于10个字符");
            }
            else{
                $('#streetdiv').attr("class", "form-group has-success");
                $('#streetblock').text("");
                b = true;
            }
            var community = $('#community').val();
            if(community==""){
                $('#communitydiv').attr("class", "form-group has-error");
                $('#communityblock').text("详细地址不可为空");
            }
            else if(community.length > 50){
                $('#communitydiv').attr("class", "form-group has-error");
                $('#communityblock').text("详细地址长度必须小于10个字符");
            }
            else{
                $('#communitydiv').attr("class", "form-group has-success");
                $('#communityblock').text("");
                c =true;
            }
            var price = $('#price').val();
            if(price==""){
                $('#pricediv').attr("class", "form-group has-error");
                $('#priceblock').text("期望租金不可为空");
            }
            else if(!/^\d+$/.test(price)){
                $('#pricediv').attr("class", "form-group has-error");
                $('#priceblock').text("请输入数字");
            }
            else{
                $('#pricediv').attr("class", "form-group has-success");
                $('#priceblock').text("");
                d = true;
            }
            var tel = $('#tel').val();
            if(tel==""){
                $('#teldiv').attr("class", "form-group has-error");
                $('#telblock').text("手机号码不可为空");
            }
            else if(tel.length != 11 || !/^1\d+$/.test(tel)){
                $('#teldiv').attr("class", "form-group has-error");
                $('#telblock').text("输入合法手机号码不合法");
            }
            else{
                $('#teldiv').attr("class", "form-group has-success");
                $('#telblock').text("");
                e = true;
            }
            if( a==true && b==true && c==true && d==true && e==true){
                $.ajax({
                    type: 'POST',
                    url: '{{ url_for('posthouse') }}',
                    data: {
                        district: district,
                        street: street,
                        community: community,
                        price: price,
                        tel: tel
                    },
                    dataType: 'json',  //指希望服务端返回json格式的数据
                    success: function (data) { //data是json格式的数据
                        if(data == 'success'){
                            alert("提交成功");
                            location.reload(true);
                        }else{
                            console.log("error");
                        }
                    },
                    error: function (xhr, type) {
                        console.log("error");
                    }
                });
            }
        })
    </script>
{% endblock %}